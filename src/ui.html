<!doctype html>
<!-- @context: export-preset-file save-dialog open-dialog apply-rehydrate feedback. -->
<!--
PM-SV-PATCH META
Version: pm-svpatch-ui@2026.02.11-r1
Last-Edited: 2026-02-11
Contains: UI shell, file tree, file view cards (view/edit/markdown/raw/fullscreen), toasts, patch controls UI.
Implemented in this version: (1) Refresh SVG icon fix (centered, consistent). (2) Refresh button alignment/feedback CSS (no logic changes).
-->
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project Manager & SV Patch</title>
  <link rel="stylesheet" href="./ui.css">
</head>
<body>
  <svg style="display:none" aria-hidden="true">
    <symbol id="icon-folder" viewBox="0 0 16 16">
      <path fill="currentColor" d="M1.75 3A1.75 1.75 0 0 0 0 4.75v6.5C0 12.216.784 13 1.75 13h12.5c.966 0 1.75-.784 1.75-1.75V5.75A1.75 1.75 0 0 0 14.25 4H7.8L6.6 2.8A1.75 1.75 0 0 0 5.36 2.25H1.75Z"/>
    </symbol>
    <symbol id="icon-file" viewBox="0 0 16 16">
      <path fill="currentColor" d="M4 1.75C4 0.784 4.784 0 5.75 0h4.19c.464 0 .91.184 1.238.512l2.072 2.072c.328.328.512.774.512 1.238v9.428A1.75 1.75 0 0 1 12.25 15h-6.5A1.75 1.75 0 0 1 4 13.25V1.75Zm6 .75v2h2l-2-2Z"/>
    </symbol>
    <symbol id="icon-chevron-right" viewBox="0 0 16 16">
      <path fill="currentColor" d="M6 3.5 11 8 6 12.5V3.5Z"/>
    </symbol>
    <symbol id="icon-chevron-down" viewBox="0 0 16 16">
      <path fill="currentColor" d="M3.5 6 8 11l4.5-5H3.5Z"/>
    </symbol>
    <symbol id="icon-eye" viewBox="0 0 16 16">
      <path fill="currentColor" d="M8 3c3.5 0 6.5 3 7.5 5-1 2-4 5-7.5 5S1.5 10 0.5 8C1.5 6 4.5 3 8 3Zm0 2.2A2.8 2.8 0 1 0 8 10.8a2.8 2.8 0 0 0 0-5.6Zm0 1.6A1.2 1.2 0 1 1 8 9.2 1.2 1.2 0 0 1 8 6.8Z"/>
    </symbol>
    <symbol id="icon-eye-off" viewBox="0 0 16 16">
      <path fill="currentColor" d="M1.1 2.2 2.2 1.1l12.7 12.7-1.1 1.1-2-2c-1.1.5-2.4.8-3.8.8C4.5 13.7 1.5 10.7.5 8c.5-1.1 1.4-2.4 2.6-3.4L1.1 2.2ZM8 4.3c1.2 0 2.4.3 3.4.8L9.9 3.6C9.3 3.4 8.6 3.3 8 3.3 4.5 3.3 1.5 6.3.5 8c.3.7.9 1.5 1.6 2.2l1-1C2.6 8.7 2.2 8.3 2 8c.8-1.4 3-3.7 6-3.7Zm0 2.1c.4 0 .8.1 1.1.3L6.7 4.3c.4-.1.8-.2 1.3-.2Zm2.6 4.4c.2-.3.4-.6.5-.8-.2-.4-.6-.9-1.1-1.4l-.9.9c.2.1.3.3.3.5a1.2 1.2 0 0 1-1.2 1.2c-.2 0-.4-.1-.5-.3l-.9.9c.5.3 1 .5 1.5.5 1.1 0 2-.4 2.3-1Z"/>
    </symbol>
    <symbol id="icon-help" viewBox="0 0 16 16">
      <path fill="currentColor" d="M8 0a8 8 0 1 0 .001 16A8 8 0 0 0 8 0Zm0 12.8a1 1 0 1 1 0-2 1 1 0 0 1 0 2ZM6.9 6.3c.1-1.5 1.2-2.4 2.7-2.4 1.5 0 2.6.9 2.6 2.2 0 1-.6 1.6-1.4 2-.7.4-1 .7-1 1.4v.2H8.2v-.3c0-1 .4-1.6 1.2-2 .6-.3 1-.6 1-1.2 0-.6-.5-1-1.2-1-.7 0-1.2.4-1.3 1.2H6.9Z"/>
    </symbol>

        <symbol id="icon-refresh" viewBox="0 0 16 16">
      <path fill="currentColor" d="M13.65 3.35a.75.75 0 0 1 0 1.06l-1.1 1.1A6 6 0 0 1 14 8a6 6 0 1 1-1.55-4.05l.14.14V2.75a.75.75 0 0 1 1.5 0v3.2c0 .41-.34.75-.75.75h-3.2a.75.75 0 0 1 0-1.5h1.58A4.5 4.5 0 1 0 12.5 8c0-.93-.28-1.8-.76-2.52l-1.2 1.2a.75.75 0 1 1-1.06-1.06l3.11-3.11a.75.75 0 0 1 1.06 0Z"/>
    </symbol>
<!-- NEW: file view icon -->
    <symbol id="icon-file-view" viewBox="0 0 16 16">
      <path fill="currentColor" d="M2.5 2.5h7a1 1 0 0 1 1 1V5h-1V3.5h-7v9h7V11h1v1.5a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1Z"/>
      <path fill="currentColor" d="M10.2 6.2c2.4 0 4.5 2.1 5 3-.5.9-2.6 3-5 3s-4.5-2.1-5-3c.5-.9 2.6-3 5-3Zm0 1.3a1.7 1.7 0 1 0 0 3.4 1.7 1.7 0 0 0 0-3.4Z"/>
    </symbol>

    <!-- NEW: RAW icon (for the up-bar button in file-view cards) -->
    <symbol id="icon-raw" viewBox="0 0 16 16">
      <!-- < > chevrons -->
      <path fill="currentColor" d="M6.2 3.2a.75.75 0 0 1 0 1.06L3.46 7l2.74 2.74a.75.75 0 1 1-1.06 1.06l-3.27-3.27a.75.75 0 0 1 0-1.06L5.14 3.2a.75.75 0 0 1 1.06 0Zm3.6 0a.75.75 0 0 1 1.06 0l3.27 3.27a.75.75 0 0 1 0 1.06l-3.27 3.27a.75.75 0 1 1-1.06-1.06L12.54 7 9.8 4.26a.75.75 0 0 1 0-1.06Z"/>
    </symbol>

    <!-- NEW: fullscreen icon -->
    <symbol id="icon-fullscreen" viewBox="0 0 16 16">
      <path fill="currentColor" d="M2 6V3.5C2 2.67 2.67 2 3.5 2H6v1H3.5C3.22 3 3 3.22 3 3.5V6H2zm11-3.5C13 3.22 12.78 3 12.5 3H10V2h2.5C13.33 2 14 2.67 14 3.5V6h-1V3.5zM3 10v2.5c0 .28.22.5.5.5H6v1H3.5C2.67 14 2 13.33 2 12.5V10h1zm11 0v2.5c0 .83-.67 1.5-1.5 1.5H10v-1h2.5c.28 0 .5-.22.5-.5V10h1z"/>
    </symbol>


        <!-- NEW: edit icon -->
    <symbol id="icon-edit" viewBox="0 0 16 16">
      <path fill="currentColor" d="M12.146 1.854a.5.5 0 0 1 .708 0l1.292 1.292a.5.5 0 0 1 0 .708l-7.94 7.94-2.2.55a.5.5 0 0 1-.606-.606l.55-2.2 7.94-7.94ZM11.5 3.207 4.478 10.23l-.27 1.08 1.08-.27L12.293 4.5 11.5 3.707 10.707 4.5 11.5 3.207Z"/>
      <path fill="currentColor" d="M2.5 13.5a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-5a.5.5 0 0 0-1 0v5a0 0 0 0 1 0 0h-9a0 0 0 0 1 0 0v-9a0 0 0 0 1 0 0h5a.5.5 0 0 0 0-1h-5a1 1 0 0 0-1 1v9Z"/>
    </symbol>

    <!-- NEW: save icon -->
    <symbol id="icon-save" viewBox="0 0 16 16">
      <path fill="currentColor" d="M2 2.75A.75.75 0 0 1 2.75 2h8.69a.75.75 0 0 1 .53.22l1.81 1.81a.75.75 0 0 1 .22.53v8.69a.75.75 0 0 1-.75.75h-10.5A.75.75 0 0 1 2 13.25V2.75ZM3.5 3.5v9h9v-7.1L11.1 3.5H10v3.25a.75.75 0 0 1-.75.75h-4.5A.75.75 0 0 1 4 6.75V3.5H3.5Zm2 0v2.5h3v-2.5h-3Z"/>
    </symbol>

<!-- NEW: close icon -->
    <symbol id="icon-x" viewBox="0 0 16 16">
      <path fill="currentColor" d="M3.7 3.7 8 8l4.3-4.3 1 1L9 9l4.3 4.3-1 1L8 10 3.7 14.3l-1-1L7 9 2.7 4.7l1-1Z"/>
    </symbol>

    <!-- NEW: tiny â€œfile typeâ€ icons (minimal VSCode-ish feel) -->
    <symbol id="icon-js" viewBox="0 0 16 16"><path fill="currentColor" d="M3 2h10v12H3z"/><path fill="#0d1117" d="M6 12c0 .8-.6 1.3-1.5 1.3-.6 0-1-.2-1.3-.6l.7-.7c.1.2.3.3.6.3.3 0 .5-.2.5-.6V7h1v5Zm2.2.8.7-.7c.3.3.6.4 1 .4.4 0 .7-.2.7-.5 0-.3-.2-.4-.6-.6l-.4-.2c-.7-.3-1.1-.6-1.1-1.4 0-.7.6-1.3 1.6-1.3.7 0 1.2.2 1.6.6l-.6.7c-.2-.2-.5-.3-.9-.3-.4 0-.6.2-.6.4 0 .3.2.4.7.6l.4.2c.8.3 1.2.7 1.2 1.5 0 .9-.7 1.4-1.7 1.4-.8 0-1.4-.2-1.8-.6Z"/></symbol>
    <symbol id="icon-json" viewBox="0 0 16 16"><path fill="currentColor" d="M3 2h10v12H3z"/><path fill="#0d1117" d="M6.2 5.5c-.7 0-1.2.6-1.2 1.4v.5c0 .8-.2 1.1-.7 1.3v.1c.5.2.7.5.7 1.3v.5c0 .8.5 1.4 1.2 1.4v-.9c-.2 0-.3-.2-.3-.5v-.6c0-.7-.2-1.1-.7-1.4.5-.3.7-.7.7-1.4v-.6c0-.3.1-.5.3-.5v-.9Zm3.6 0v.9c.2 0 .3.2.3.5v.6c0 .7.2 1.1.7 1.4-.5.3-.7.7-.7 1.4v.6c0 .3-.1.5-.3.5v.9c.7 0 1.2-.6 1.2-1.4v-.5c0-.8.2-1.1.7-1.3v-.1c-.5-.2-.7-.5-.7-1.3v-.5c0-.8-.5-1.4-1.2-1.4Z"/></symbol>
    <symbol id="icon-py" viewBox="0 0 16 16"><path fill="currentColor" d="M3 2h10v12H3z"/><path fill="#0d1117" d="M6 6.2c0-.9.7-1.6 1.6-1.6h1.6V6H7.6c-.1 0-.2.1-.2.2v.2h2c.9 0 1.6.7 1.6 1.6v1.6c0 .9-.7 1.6-1.6 1.6H7.8V10h1.6c.1 0 .2-.1.2-.2v-.2h-2C6.7 9.6 6 8.9 6 8V6.2Z"/></symbol>
    <symbol id="icon-md" viewBox="0 0 16 16"><path fill="currentColor" d="M3 2h10v12H3z"/><path fill="#0d1117" d="M5 11V6h1l1.5 2 1.5-2h1v5H9V8.1L7.5 10 6 8.1V11H5Zm7-1.5V6h1v3l1-1 .7.7L13 10.9l-1.7-2.2.7-.7 1 1Z"/></symbol>
  </svg>

  <!-- NEW: floating file view layer -->
  <div id="fileViewLayer" class="fvLayer"></div>

  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="brandTitle">Project Manager & SV Patch</div>
        <div class="brandSub" id="projectPath">No folder opened</div>
      </div>

      <div class="topActions">
        <button class="btn ghost" id="btnHelp" title="Help">
          <svg class="ico"><use href="#icon-help"></use></svg>
          Help
        </button>
        <button class="btn primary" id="btnOpen">Open</button>
      </div>
    </header>

    <main class="layout">
      <section class="panel files">
        <div class="panelHead">
          <div class="panelTitleRow">
            <div class="panelTitle">Files</div>
            <button class="actionBtn headBtn" id="btnRefreshFiles" title="Refresh files">
              <svg class="ico"><use href="#icon-refresh"></use></svg>
            </button>
            <div class="presetQuick" id="presetQuickControls">
              <button class="btn secondary tiny" id="btnPresetSaveFile" type="button">Save preset…</button>
              <button class="btn secondary tiny" id="btnPresetImportFile" type="button">Import preset…</button>
            </div>
          </div>
          <div class="panelHeadTools">
            <div class="filesSearchWrap" id="filesSearchWrap">
              <input type="text" id="filesSearchInput" class="filesSearchInput" placeholder="Search…" aria-label="Search files" autocomplete="off" />
              <button type="button" class="filesSearchClear" id="filesSearchClear" aria-label="Clear search" title="Clear search">×</button>
            </div>
          </div>
          <div class="panelMeta" id="itemsCount">0 items</div>
          <div class="panelMeta presetFeedback" id="presetFeedback">Preset: None</div>
        </div>

        <div class="fileList" id="fileList"></div>

        <div class="panelFoot">
          <button class="btn secondary small" id="btnClearIgnored">Clear ignored</button>
          <div class="stats" id="stats"></div>
        </div>
      </section>

      <section class="panel right">
        <div class="tabs">
          <button class="tab active" data-tab="overview">Overview</button>
          <button class="tab" data-tab="export">Export</button>
          <button class="tab" data-tab="logs">Logs</button>
          <button class="tab" data-tab="patch">Patch</button>
        </div>

        <div class="tabBody">
          <div class="tabPanel active" id="tab-overview">
            <div class="card exportLegacyCard" data-export-legacy="1">
              <div class="cardTitle">Export</div>
              <div class="cardRow">
                <button class="btn primary" id="btnExportTxt">Export TXT</button>
                <button class="btn secondary" id="btnExportJson">Export JSON</button>
              </div>
              <div class="cardRow exportSelRow">
                <div class="exportSelToggleWrap">
                  <span class="exportSelLabel">Export selected only</span>
                  <label class="exportSelSwitch" aria-label="Export selected only">
                    <input type="checkbox" id="chkExportSelectedOnly" aria-label="Export selected only" />
                    <span class="exportSelSlider" aria-hidden="true"></span>
                  </label>
                </div>
                <span class="hint exportSelCount" id="exportSelectedCount">Selected: 0</span>
              </div>
              <div class="cardRow exportSelActions">
                <button class="btn secondary small" id="btnSelectAllVisible">Select all visible</button>
                <button class="btn secondary small" id="btnClearSelection">Clear selection</button>
              </div>
              <div class="hint">Exports respect ignored items.</div>
            </div>

            <div class="card">
              <div class="cardTitle">Status</div>
              <div class="hint" id="statusLine">Ready.</div>
            </div>
          </div>

          <div class="tabPanel" id="tab-export">
            <div class="card exportPanel">
              <div class="cardTitle">Export Type</div>

              <div class="hint">Choose format and scope, then export using the primary action.</div>

              <div class="exportGroup">
                <div class="exportGroupTitle">Format</div>
                <div class="segCtl" role="radiogroup" aria-label="Export format">
                  <button type="button" class="segBtn active" data-export-type="txt" id="btnExportTypeTxt">TXT</button>
                  <button type="button" class="segBtn" data-export-type="json" id="btnExportTypeJson">JSON</button>
                </div>
              </div>

              <div class="exportGroup">
                <div class="cardRow exportSelRow">
                  <div class="exportSelToggleWrap">
                    <span class="exportSelLabel">Export selected only</span>
                    <label class="exportSelSwitch" aria-label="Export selected only">
                      <input type="checkbox" id="chkExportSelectedOnlyTab" aria-label="Export selected only" />
                      <span class="exportSelSlider" aria-hidden="true"></span>
                    </label>
                  </div>
                  <span class="hint exportSelCount" id="exportSelectedCountTab">Selected: 0</span>
                </div>
              </div>

              <div class="exportGroup">
                <div class="exportGroupTitle">Content level <span class="hint">(coming soon)</span></div>
                <div class="segCtl" role="radiogroup" aria-label="Content level">
                  <button type="button" class="segBtn active" data-content-level="compact" id="btnContentCompact">Compact</button>
                  <button type="button" class="segBtn" data-content-level="standard" id="btnContentStandard">Standard</button>
                  <button type="button" class="segBtn" data-content-level="full" id="btnContentFull">Full</button>
                </div>
              </div>

              <div class="exportGroup">
                <div class="exportGroupTitle">Options <span class="hint">(coming soon)</span></div>
                <label class="optChk"><input type="checkbox" id="optTreeHeader" checked /> Export tree in header</label>
                <label class="optChk"><input type="checkbox" id="optIgnoredSummary" checked /> Include ignored summary</label>
                <label class="optChk"><input type="checkbox" id="optHashes" /> Include hashes (sha256)</label>
                <label class="optChk"><input type="checkbox" id="optSortDet" checked /> Sort: dirs first + alpha</label>
              </div>

              <div class="exportGroup">
                <div class="exportGroupTitle">Live Summary</div>
                <div class="hint" id="exportLiveSummary">Mode: All · Selected: 0 · Resolved files: 0 · Format: TXT · Estimated size: ~0 KB</div>
              </div>

              <div class="cardRow exportSelActions">
                <button class="btn secondary small" id="btnSelectAllVisibleTab">Select all visible</button>
                <button class="btn secondary small" id="btnClearSelectionTab">Clear selection</button>
              </div>

              <div class="cardRow">
                <button class="btn primary" id="btnExportPrimary">Export</button>
              </div>
            </div>
          </div>

          <div class="tabPanel" id="tab-logs">
            <div class="card">
              <div class="cardRow spread">
                <div class="cardTitle">Logs</div>
                <div class="rowActions">
                  <button class="btn secondary small" id="btnCopyLogs">Copy</button>
                  <button class="btn small danger" id="btnClearLogs">Clear</button>
                </div>
              </div>
              <pre class="logBox" id="logBox"></pre>
            </div>
          </div>

          <div class="tabPanel" id="tab-patch">
            <div class="card">
              <div class="cardTitle">Tool</div>

              <div class="hint">Runner (configurÃ¡vel). O app lÃª o manifesto ao lado do runner.</div>
              <div class="cardRow">
                <button class="btn secondary" id="btnPickRunner">Pick runner</button>
                <button class="btn secondary" id="btnReloadManifest">Reload</button>
              </div>

              <div class="toolBox">
                <div class="toolRow">
                  <div class="toolLabel">Runner:</div>
                  <div class="toolValue mono" id="runnerLine">(not set)</div>
                </div>
                <div class="toolRow">
                  <div class="toolLabel">Manifest:</div>
                  <div class="toolValue mono" id="manifestLine">(not found)</div>
                </div>
                <div class="toolRow">
                  <div class="toolLabel">Tool:</div>
                  <div class="toolValue" id="toolNameLine">â€”</div>
                </div>
                <div class="toolRow">
                  <div class="toolLabel">Version:</div>
                  <div class="toolValue mono" id="toolVerLine">â€”</div>
                </div>
              </div>

              <details class="details" open>
                <summary>How it works (from manifest)</summary>
                <div class="detailsBody">
                  <div class="hint" id="toolDescLine">â€”</div>
                  <div class="docList" id="howToList"></div>

                  <div class="hint" style="margin-top:10px">Example pipeline:</div>
                  <pre class="codeBox mono" id="pipelineExample">(none)</pre>
                </div>
              </details>
            </div>

            <div class="card">
              <div class="cardTitle">Pipeline Builder</div>
              <div class="hint">Selecione 1+ arquivos <b>.rw</b> (precisam estar dentro do root do projeto).</div>

              <div class="cardRow">
                <button class="btn secondary" id="btnPickRw">Pick .rw</button>
                <button class="btn secondary" id="btnClearRw">Clear</button>
              </div>

              <div class="rwWrap">
                <div class="rwHead">
                  <div class="hint">Selected .rw</div>
                  <div class="hint" id="rwMeta">0 selected</div>
                </div>
                <div class="rwList mono" id="rwList"></div>
                <div class="hint warn" id="rwWarn" style="display:none"></div>
              </div>

              <div class="cardRow spread">
                <div class="hint">Pipeline JSON (editÃ¡vel)</div>
                <button class="btn secondary small" id="btnSavePipeline">Save</button>
              </div>

              <textarea class="textarea mono" id="pipelineText" spellcheck="false" placeholder="{ ... pipeline.json ... }"></textarea>

              <div class="hint mono" id="pipelinePathLine">Pipeline: (not saved)</div>

              <div class="cardRow">
                <button class="btn secondary" id="btnRunPlan">Run Plan</button>
                <button class="btn primary" id="btnRunApply">Run Apply</button>
                <button class="btn danger" id="btnStopPatch">Stop</button>
              </div>

              <div class="hint">
                Tip: <b>Run Plan</b> nÃ£o escreve no disco. <b>Run Apply</b> aplica e faz backup/rollback (se o manifesto suportar).
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="applyDiffModal" class="applyDiffModal" hidden aria-hidden="true">
    <div class="applyDiffDialog" role="dialog" aria-modal="true" aria-labelledby="applyDiffTitle">
      <div class="applyDiffHead">
        <div class="applyDiffHeadMain">
          <div class="cardTitle" id="applyDiffTitle">Apply Preview</div>
          <div class="hint" id="applyDiffSummaryLine">No preview loaded.</div>
        </div>
        <div class="applyDiffHeadActions">
          <button class="btn secondary small" id="btnApplyDiffRefresh">Refresh Preview</button>
          <button class="btn secondary small" id="btnApplyDiffCancel">Cancel</button>
          <button class="btn primary small" id="btnApplyDiffRunApply">Run Apply</button>
        </div>
      </div>

      <div class="applyDiffBody">
        <aside class="applyDiffSidebar">
          <div class="applyDiffSearchWrap">
            <input
              class="applyDiffSearch mono"
              id="applyDiffSearch"
              type="search"
              placeholder="Filter files..."
              spellcheck="false"
            />
          </div>
          <div class="applyDiffFileList" id="applyDiffFileList"></div>
        </aside>

        <section class="applyDiffViewer">
          <div class="applyDiffViewerHead">
            <div class="applyDiffPath mono" id="applyDiffPathLine">(no file selected)</div>
            <div class="hint mono" id="applyDiffMetaLine"></div>
          </div>

          <div class="applyDiffGrid" id="applyDiffGrid">
            <div class="applyDiffPane">
              <div class="applyDiffPaneHead">Before</div>
              <div class="applyDiffCode" id="applyDiffBefore"></div>
            </div>
            <div class="applyDiffPane">
              <div class="applyDiffPaneHead">After</div>
              <div class="applyDiffCode" id="applyDiffAfter"></div>
            </div>
          </div>

          <pre class="applyDiffFallback mono" id="applyDiffFallback" hidden></pre>
        </section>
      </div>
    </div>
  </div>

  <script src="./ui.js"></script>
  <div id="toastHost" class="toastHost" aria-live="polite"></div>
</body>
</html>
