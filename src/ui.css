/*
PM-SV-PATCH META
Version: pm-svpatch-ui@2026.02.11-r1
Last-Edited: 2026-02-11
Contains: UI shell, file tree, file view cards (view/edit/markdown/raw/fullscreen), toasts, patch controls UI.
Implemented in this version: (1) Refresh SVG icon fix (centered, consistent). (2) Refresh button alignment/feedback CSS (no logic changes).
*/
:root{
  --bg:#0d1117;
  --surface:#161b22;
  --text:#c9d1d9;
  --muted:#8b949e;
  --border:#30363d;
  --border2:#3c444d;
  --accent:#1f6feb;
  --danger:#f85149;
  --success:#3fb950;

  --r:10px;
  --r2:8px;
  --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:var(--font);
  font-size:14px;
}

.app{min-height:100%; display:flex; flex-direction:column}

.topbar{
  position:sticky; top:0; z-index:20;
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 16px;
  background:rgba(13,17,23,.92);
  border-bottom:1px solid var(--border);
  backdrop-filter: blur(10px);
}

.brandTitle{font-weight:700; letter-spacing:.2px}
.brandSub{font-size:12px; color:var(--muted); margin-top:2px; max-width:56vw; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}

.topActions{display:flex; gap:8px; align-items:center}

.layout{
  flex:1;
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap:16px;
  padding:16px;
}

.panel{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  overflow:hidden;
}

.panelHead{
  padding:12px 14px;
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  border-bottom:1px solid var(--border);
}


.panelTitleRow{
  display:flex;
  align-items:center;
  gap:8px;
}
.headBtn{
  padding:6px;
}

.panelTitle{font-weight:700}
.panelMeta{color:var(--muted); font-size:12px}

.panelHeadTools{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
}

.filesSearchWrap{
  position:relative;
  display:flex;
  align-items:center;
  min-width:0;
}

.filesSearchInput{
  width:150px;
  height:26px;
  border:1px solid var(--border);
  border-radius:7px;
  background:rgba(13,17,23,.65);
  color:var(--text);
  font-size:12px;
  padding:0 22px 0 8px;
  outline:none;
}

.filesSearchInput::placeholder{ color:var(--muted); }

.filesSearchInput:focus{
  border-color:var(--border2);
  box-shadow:0 0 0 1px rgba(201,209,217,.08);
}

.filesSearchClear{
  position:absolute;
  right:4px;
  width:18px;
  height:18px;
  border:none;
  border-radius:50%;
  background:transparent;
  color:var(--muted);
  font-size:14px;
  line-height:1;
  display:none;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  padding:0;
}

.filesSearchClear:hover{
  color:var(--text);
  background:rgba(201,209,217,.08);
}

.filesSearchWrap.hasValue .filesSearchClear{ display:inline-flex; }

.panelFoot{
  padding:10px 12px;
  border-top:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.stats{color:var(--muted); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

.btn{
  border:1px solid var(--border);
  background:rgba(22,27,34,.6);
  color:var(--text);
  border-radius:8px;
  padding:8px 12px;
  cursor:pointer;
  transition:.12s ease;
  display:inline-flex;
  align-items:center;
  gap:8px;
}

.btn:hover{border-color:var(--border2); transform:translateY(-1px)}
.btn:active{transform:translateY(0)}
.btn.small{padding:6px 10px; font-size:13px}
.btn.ghost{background:transparent}
.btn.primary{background:var(--accent); border-color:rgba(255,255,255,.12)}
.btn.primary:hover{filter:brightness(1.04)}
.btn.danger{background:rgba(248,81,73,.10); border-color:rgba(248,81,73,.35)}
.btn.danger:hover{background:rgba(248,81,73,.16)}
.btn:disabled{opacity:.55; cursor:not-allowed; transform:none}

.ico{width:16px; height:16px; color:var(--muted)}
.btn.primary .ico{color:white}

.fileList{ padding:0; }

.row{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
}
.row:last-child{border-bottom:none}
.row:hover{background:rgba(255,255,255,.02)}
.row.selected{background:rgba(31,111,235,.12); outline:1px solid rgba(31,111,235,.25); outline-offset:-1px}
.row.ignored{opacity:.72}

.rowLeft{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
  flex:1;
}

.caret{
  width:18px; height:18px;
  border-radius:6px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  color:var(--muted);
  cursor:pointer;
}
.caret:hover{background:rgba(255,255,255,.03); color:var(--text)}
.caret .ico{width:14px; height:14px}

.fileIco{color:var(--muted)}
.row:hover .fileIco{color:var(--text)}

.name{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  cursor:default;
}

.actions{
  display:flex;
  align-items:center;
  gap:8px;
  opacity:0;
  pointer-events:none;
  transition:.12s ease;
}
.row:hover .actions{opacity:1; pointer-events:auto}
.row.ignored .actions{opacity:1; pointer-events:auto}

.actionBtn{
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  border-radius:8px;
  padding:6px;
  cursor:pointer;
  display:inline-flex;
}
.actionBtn:hover{background:rgba(255,255,255,.03); color:var(--text); border-color:var(--border)}
.actionBtn .ico{width:16px; height:16px}

.badge{
  font-size:11px;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  color:var(--muted);
  background:rgba(0,0,0,.15);
}

.tabs{
  display:flex;
  gap:6px;
  padding:10px 10px 0 10px;
  border-bottom:1px solid var(--border);
}

.tab{
  appearance:none;
  border:1px solid var(--border);
  background:transparent;
  color:var(--muted);
  border-radius:10px 10px 0 0;
  padding:8px 10px;
  cursor:pointer;
}

.tab.active{
  color:var(--text);
  background:rgba(13,17,23,.25);
  border-bottom-color:transparent;
}

.tabBody{padding:12px}
.tabPanel{display:none}
.tabPanel.active{display:block}

.card{
  border:1px solid var(--border);
  background:rgba(13,17,23,.25);
  border-radius:var(--r2);
  padding:12px;
  margin-bottom:12px;
}

.cardTitle{font-weight:700; margin-bottom:10px}
.cardRow{display:flex; gap:10px; align-items:center; margin-bottom:10px}
.cardRow.spread{justify-content:space-between}
.hint{color:var(--muted); font-size:12px; line-height:1.4}
.hint b{color:var(--text)}
.hint.warn{color:rgba(248,81,73,.95)}

.logBox{
  margin:0;
  height:320px;
  overflow:auto;
  padding:10px;
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.18);
  font-family:var(--mono);
  font-size:12.5px;
  color:var(--text);
  white-space:pre-wrap;
}

/* Patch UI */
.mono{ font-family:var(--mono); }

.rwWrap{
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.14);
  padding:10px;
  margin:8px 0 12px 0;
}

.rwHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:8px;
}

.rwList{
  max-height:120px;
  overflow:auto;
  padding:8px;
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.16);
  font-size:12.5px;
}

.rwItem{
  padding:6px 6px;
  border-bottom:1px solid rgba(48,54,61,.6);
}
.rwItem:last-child{border-bottom:none}

.rwEmpty{
  color:var(--muted);
  padding:6px 6px;
}

.textarea{
  width:100%;
  height:220px;
  resize:vertical;
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.18);
  color:var(--text);
  padding:10px;
  outline:none;
  line-height:1.35;
}
.textarea:focus{
  border-color:rgba(31,111,235,.5);
  box-shadow:0 0 0 3px rgba(31,111,235,.15);
}

/* Tool info box */
.toolBox{
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.14);
  padding:10px;
  margin:10px 0;
}

.toolRow{
  display:grid;
  grid-template-columns: 90px 1fr;
  gap:10px;
  padding:6px 0;
  border-bottom:1px solid rgba(48,54,61,.55);
}
.toolRow:last-child{border-bottom:none}

.toolLabel{
  color:var(--muted);
  font-size:12px;
}
.toolValue{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.details{
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.12);
  padding:8px 10px;
}
.details summary{
  cursor:pointer;
  color:var(--text);
  font-weight:600;
  user-select:none;
}
.detailsBody{
  padding-top:10px;
}

.docList{ margin-top:8px; }
.docItem{
  color:var(--text);
  font-size:12.5px;
  padding:4px 0;
}

.codeBox{
  margin:8px 0 0 0;
  max-height:180px;
  overflow:auto;
  padding:10px;
  border:1px solid var(--border);
  border-radius:8px;
  background:rgba(0,0,0,.18);
  white-space:pre;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NEW: Floating File View cards
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.fvLayer{
  position:fixed;
  inset:0;
  z-index:999;
  pointer-events:none; /* layer itself doesn't block clicks */
}

.fvCard{
  position:absolute;
  pointer-events:auto;
  width:560px;
  height:360px;
  min-width:320px;
  min-height:220px;
  max-width:92vw;
  max-height:86vh;

  background:rgba(13,17,23,.98);
  border:1px solid var(--border);
  border-radius:12px;
  border-color: rgba(240,246,252,.12);
  box-shadow:
  0 8px 22px rgba(0,0,0,.22),
  0 2px 8px rgba(0,0,0,.16);
overflow:hidden;

  resize: both;
}

.fvHead{
  height:44px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:0 10px;
  border-bottom:1px solid var(--border);
  background:rgba(22,27,34,.92);
  cursor:move;
  user-select:none;
}

.fvHeadLeft{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}

.fvTypeIcon{
  width:24px;
  height:24px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
  flex:0 0 auto;
}

.fvTypeIcon .ico{
  width:22px;
  height:22px;
}

.fvTitle{
  font-weight:650;
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.fvMeta{
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
}

.fvHeadRight{
  display:flex;
  align-items:center;
  gap:8px;
}

.fvBtn{
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  border-radius:8px;
  padding:6px;
  cursor:pointer;
  display:inline-flex;
}
.fvBtn:hover{
  background:rgba(255,255,255,.03);
  color:var(--text);
  border-color:var(--border);
}

.fvBody{
  height:calc(100% - 44px);
  overflow:auto;
  background:rgba(0,0,0,.18);
}


.fvViewer{
  height:100%;
}

.fvEditor{
  width:100%;
  height:100%;
  margin:0;
  border:0;
  outline:none;
  padding:12px 14px;
  font-family:var(--mono);
  font-size:12.5px;
  line-height:1.45;
  background:rgba(0,0,0,.10);
  color:var(--text);
  resize:none;
  white-space:pre;
  overflow:auto;
}

.fvBtn.active{
  background:rgba(31,111,235,.10);
  border-color:rgba(31,111,235,.35);
  color:var(--text);
}


.fvCode{
  margin:0;
  padding:12px 14px;
  font-family:var(--mono);
  font-size:12.5px;
  line-height:1.45;
  white-space:pre;
  color:var(--text);
}

/* simple GitHub-like token colors */
.tok-comment{ color:#8b949e; }
.tok-string{ color:#a5d6ff; }
.tok-number{ color:#d2a8ff; }
.tok-keyword{ color:#ff7b72; }
.tok-boolean{ color:#79c0ff; }
.tok-null{ color:#79c0ff; }
.tok-punct{ color:#c9d1d9; }

/* Markdown preview inside File View (.md) */
.fvBtn.active{
  background:rgba(88,166,255,.10);
  color:var(--text);
  border-color:rgba(88,166,255,.22);
}

.fvMd{
  padding:14px 16px;
  color:var(--text);
  font-size:13.5px;
  line-height:1.55;
}
.fvMd h1,.fvMd h2,.fvMd h3{
  margin:14px 0 10px 0;
  font-weight:750;
  line-height:1.25;
}
.fvMd h1{font-size:20px; border-bottom:1px solid rgba(240,246,252,.12); padding-bottom:6px;}
.fvMd h2{font-size:17px; border-bottom:1px solid rgba(240,246,252,.10); padding-bottom:4px;}
.fvMd h3{font-size:15px;}
.fvMd p{margin:10px 0;}
.fvMd a{color:#58a6ff; text-decoration:none;}
.fvMd a:hover{text-decoration:underline;}
.fvMd ul{margin:8px 0 8px 18px; padding:0;}
.fvMd li{margin:4px 0;}
.fvMd blockquote{
  margin:10px 0;
  padding:8px 12px;
  border-left:3px solid rgba(240,246,252,.12);
  background:rgba(255,255,255,.02);
  color:var(--muted);
}
.fvMd hr{
  border:none;
  border-top:1px solid rgba(240,246,252,.10);
  margin:14px 0;
}

.mdInline{
  padding:2px 6px;
  border:1px solid rgba(240,246,252,.10);
  border-radius:6px;
  background:rgba(0,0,0,.18);
  font-family:var(--mono);
  font-size:12.5px;
}
.mdCode{
  margin:10px 0;
  padding:12px 14px;
  border:1px solid rgba(240,246,252,.10);
  border-radius:10px;
  background:rgba(0,0,0,.20);
  overflow:auto;
  font-family:var(--mono);
  font-size:12.5px;
  line-height:1.45;
  white-space:pre;
}
.mdEmpty{color:var(--muted);}


/* NEW: discard confirm bar (visual confirmation when leaving edit with unsaved changes) */
.fvConfirmBar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 10px;
  border-bottom:1px solid rgba(240,246,252,.10);
  background:rgba(248,81,73,.10);
}
.fvConfirmText{
  color:var(--text);
  font-size:12.5px;
}
.fvConfirmActions{
  display:flex;
  align-items:center;
  gap:8px;
}
.fvMiniBtn{
  border:1px solid rgba(240,246,252,.12);
  background:rgba(255,255,255,.03);
  color:var(--text);
  border-radius:8px;
  padding:6px 10px;
  cursor:pointer;
  font-size:12.5px;
}
.fvMiniBtn:hover{background:rgba(255,255,255,.05)}
.fvMiniBtn.danger{
  border-color:rgba(248,81,73,.35);
  background:rgba(248,81,73,.16);
}
.fvMiniBtn.danger:hover{background:rgba(248,81,73,.22)}


/* Fullscreen (B): cover all except topbar */
.fvCard.fvFullscreen{
  position: fixed !important;
  left: 0 !important;
  top: var(--topbarH, 56px) !important;
  width: 100vw !important;
  height: calc(100vh - var(--topbarH, 56px)) !important;
  max-width: none !important;
  max-height: none !important;
  min-width: 0 !important;
  min-height: 0 !important;
  resize: none !important;
  border-radius: 0 !important;
  z-index: 9999 !important;
}


/* PATCH: hide underlying layout while a File View card is fullscreen (prevents sidebar bleed-through) */
body.has-fv-fullscreen .layout{
  visibility:hidden !important;
}



/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Toasts (bottom-right)
*/
.toastHost{
  position:fixed;
  right:16px;
  bottom:16px;
  z-index:99999;
  display:flex;
  flex-direction:column;
  gap:10px;
  pointer-events:none;
}
.toast{
  pointer-events:auto;
  min-width:240px;
  max-width:360px;
  background:rgba(22,27,34,0.96);
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow:0 10px 28px rgba(0,0,0,0.30);
  padding:10px 10px;
  display:flex;
  align-items:flex-start;
  gap:10px;
  transform:translateY(6px);
  opacity:0;
  animation:toastIn .16s ease-out forwards;
}
.toastBody{
  flex:1;
  color:var(--text);
  font-size:13px;
  line-height:1.35;
  white-space:pre-wrap;
  word-break:break-word;
}
.toastX{
  width:26px;
  height:26px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  opacity:0.85;
}
.toastX:hover{opacity:1}
.toastX svg{width:14px;height:14px;fill:currentColor}
.toast-success{border-color:rgba(63,185,80,0.55)}
.toast-warn{border-color:rgba(210,153,34,0.55)}
.toast-error{border-color:rgba(248,81,73,0.55)}
.toast-info{border-color:rgba(31,111,235,0.55)}
.toast.leaving{
  animation:toastOut .18s ease-in forwards;
}
@keyframes toastIn{
  from{opacity:0; transform:translateY(10px)}
  to{opacity:1; transform:translateY(0)}
}
@keyframes toastOut{
  from{opacity:1; transform:translateY(0)}
  to{opacity:0; transform:translateY(10px)}
}

/* === Scroll containment (IDE-like) === */
html, body{ height:100%; }
body{ overflow:hidden; }

/* keep the whole app as a viewport container; scroll happens inside panels */
.app{ height:100vh; }
.layout{ min-height:0; overflow:hidden; }

/* make both columns behave like IDE panes */
.panel.files,
.panel.right{
  display:flex;
  flex-direction:column;
  min-height:0;
}

/* left file tree scrolls inside its own pane */
.fileList{
  flex:1;
  min-height:0;
  overflow:auto;
}

/* right side tabs: header fixed, content scrolls */
.tabs{ flex:0 0 auto; }
.tabBody{
  flex:1;
  min-height:0;
  overflow:auto;
}


/* PATCH: execution state (disable + subtle busy look) */
.btn.busy{
  cursor:progress;
  opacity:.75;
  transform:none !important;
}
.btn.busy:hover{
  border-color:var(--border) !important;
  transform:none !important;
}


/* PATCH: fix toast close button alignment (keep X on far right) */
.toast{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.toast .toastBodyWrap{
  flex:1 1 auto;
  min-width:0;
}

.toast .toastX{
  flex:0 0 auto;
  align-self:center;
  margin-left:8px;
}


/* PATCH: refresh button better icon sizing + busy feedback */
.panelTitleRow .headBtn .ico{ width:16px; height:16px; }

.headBtn.busy{
  opacity:.75;
  cursor:progress;
  pointer-events:none;
}

.headBtn.busy .ico{
  animation: spin 0.9s linear infinite;
  color: var(--text);
}

@keyframes spin{
  from{ transform:rotate(0deg); }
  to{ transform:rotate(360deg); }
}


/* PATCH: refresh button alignment (Files header) */
.panelTitleRow{ gap:10px; }
.panelTitle{ line-height:1; }

.panelTitleRow .headBtn{
  width:28px;
  height:28px;
  padding:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

.panelTitleRow .headBtn .ico{
  width:14px;
  height:14px;
}

/* keep hover consistent */
.panelTitleRow .headBtn:hover .ico{ color:var(--text); }

/* PATCH: prevent double scrollbar in File View editor (outer body + textarea) */
.fvCard[data-editing="1"] .fvBody{
  overflow: hidden !important; /* outer must NOT scroll while editing */
}

.fvCard[data-editing="1"] textarea,
.fvCard[data-editing="1"] .fvEditor,
.fvCard[data-editing="1"] .editor,
.fvCard[data-editing="1"] .codeEditor{
  overflow: auto !important;   /* inner editor owns scrolling */
}


/* =========================================================
   PM-SV-PATCH: Incremental Visual Identity + UX Layer
   Scope: visual-only overrides (no behavior/logic changes)
   ========================================================= */
:root{
  /* Design tokens (requested) */
  --bg-base:#0d1117;
  --bg-surface:#151b23;
  --bg-elevated:#1b2330;

  --border-subtle:#2f3742;
  --border-focus:rgba(64,146,255,.55);

  --text-primary:#e6edf3;
  --text-secondary:#c9d1d9;
  --text-muted:#8b949e;

  --accent:#2f81f7;
  --accent-hover:#4092ff;
  --accent-active:#1f6feb;
  --accent-soft:rgba(47,129,247,.16);

  /* 8px spacing system */
  --space-1:8px;
  --space-2:16px;
  --space-3:24px;
  --space-4:32px;

  /* Visual helpers */
  --active-ring:0 0 0 1px rgba(64,146,255,.50);
  --active-shadow:0 12px 28px rgba(0,0,0,.28);
  --elevated-shadow:0 10px 24px rgba(0,0,0,.20);

  /* Backward-compatible aliases */
  --bg:var(--bg-base);
  --surface:var(--bg-surface);
  --text:var(--text-primary);
  --muted:var(--text-muted);
  --border:var(--border-subtle);
  --border2:#3b4452;
}

body{
  background:var(--bg-base);
  color:var(--text-primary);
}

.topbar{
  padding:var(--space-2);
  background:rgba(13,17,23,.94);
  border-bottom-color:var(--border-subtle);
}

.brandSub,
.panelMeta,
.stats,
.hint,
.toolLabel,
.rwEmpty{
  color:var(--text-muted);
}

.layout{
  padding:var(--space-2);
  gap:var(--space-2);
  background:var(--bg-base);
}

.panel{
  background:var(--bg-surface);
  border-color:var(--border-subtle);
  transition:border-color .16s ease, box-shadow .16s ease, background-color .16s ease;
}

.panel.files,
.panel.right{
  background:var(--bg-surface);
}

.panelHead{
  padding:var(--space-2);
  border-bottom-color:var(--border-subtle);
}

.panelFoot{
  padding:var(--space-1) var(--space-2);
  border-top-color:var(--border-subtle);
}

.tabs{
  padding:var(--space-1) var(--space-1) 0 var(--space-1);
  border-bottom-color:var(--border-subtle);
  background:var(--bg-surface);
}

.tabBody{
  padding:var(--space-2);
  background:var(--bg-base); /* Workspace -> base */
}

.tab{
  border-color:var(--border-subtle);
  color:var(--text-muted);
  padding:var(--space-1) var(--space-2);
  background:transparent;
  transition:border-color .12s ease, color .12s ease, background-color .12s ease;
}

.tab:hover{
  color:var(--text-secondary);
  border-color:var(--border2);
  background:rgba(255,255,255,.03);
}

.tab.active{
  color:var(--text-primary);
  background:var(--bg-base);
  border-color:var(--border-subtle);
  border-bottom-color:var(--bg-base);
}

.card{
  background:var(--bg-elevated); /* Cards -> elevated */
  border-color:var(--border-subtle);
  padding:var(--space-2);
  margin-bottom:var(--space-2);
  box-shadow:var(--elevated-shadow);
  transition:border-color .16s ease, box-shadow .16s ease, background-color .16s ease;
}

.cardRow{
  gap:var(--space-1);
  margin-bottom:var(--space-1);
}

.row{
  padding:var(--space-1) var(--space-2);
  border-bottom-color:var(--border-subtle);
}

.row:hover{
  background:rgba(255,255,255,.03);
}

.row.selected{
  background:var(--accent-soft);
  outline:1px solid rgba(64,146,255,.40);
}

.rwWrap,
.rwList,
.toolBox,
.details,
.logBox,
.codeBox,
.textarea{
  border-color:var(--border-subtle);
  background:rgba(0,0,0,.18);
}

.textarea:focus{
  border-color:var(--border-focus);
  box-shadow:0 0 0 3px rgba(64,146,255,.16);
}

.fvCard{
  background:var(--bg-elevated); /* File Viewer -> elevated */
  border-color:var(--border-subtle);
  box-shadow:var(--elevated-shadow);
  transition:border-color .16s ease, box-shadow .16s ease, background-color .16s ease;
}

.fvHead{
  background:var(--bg-surface);
  border-bottom-color:var(--border-subtle);
}

.fvBody,
.fvEditor{
  background:rgba(0,0,0,.16);
}

/* Active window/card emphasis (no focus logic changes) */
.panel:focus-within,
.card:focus-within,
.fvCard:hover,
.fvCard:focus-within{
  border-color:var(--accent);
  box-shadow:var(--active-ring), var(--active-shadow);
}

.fvBtn.active,
.btn.primary,
#btnRunApply{
  background:var(--accent);
  border-color:rgba(255,255,255,.15);
  color:#fff;
}

.fvBtn.active:hover,
.btn.primary:hover,
#btnRunApply:hover{
  background:var(--accent-hover);
}

.fvBtn.active:active,
.btn.primary:active,
#btnRunApply:active{
  background:var(--accent-active);
}

/* Secondary / default buttons */
.btn,
.btn.secondary{
  border-color:var(--border-subtle);
  background:rgba(22,27,34,.70);
  color:var(--text-secondary);
  padding:var(--space-1) var(--space-2);
  transition:border-color .12s ease, background-color .12s ease, color .12s ease, box-shadow .12s ease, transform .12s ease;
}

.btn.small{
  padding:var(--space-1);
}

.btn.secondary{
  background:rgba(22,27,34,.74);
  border-color:var(--border-subtle);
  color:var(--text-secondary);
}

.btn.secondary:active{
  background:rgba(30,37,48,.98);
}

.btn:not(.primary):not(.danger):not(.ghost):hover,
.btn.secondary:hover{
  border-color:var(--border2);
  background:rgba(30,37,48,.95);
  color:var(--text-primary);
}

/* Ghost buttons for toolbar/light controls */
.btn.ghost,
.actionBtn,
.headBtn,
.fvBtn,
.toastX{
  background:transparent;
  border-color:transparent;
  color:var(--text-muted);
}

.btn.ghost:hover,
.actionBtn:hover,
.headBtn:hover,
.fvBtn:hover,
.toastX:hover{
  background:rgba(255,255,255,.04);
  border-color:var(--border-subtle);
  color:var(--text-primary);
}

.btn.danger{
  background:rgba(248,81,73,.14);
  border-color:rgba(248,81,73,.36);
  color:#ffd4d2;
}

.btn.danger:hover{
  background:rgba(248,81,73,.22);
  border-color:rgba(248,81,73,.50);
}

/* Consistent states: hover / focus / disabled / busy */
.btn:focus-visible,
.actionBtn:focus-visible,
.headBtn:focus-visible,
.fvBtn:focus-visible,
.tab:focus-visible,
.toastX:focus-visible{
  outline:none;
  border-color:var(--border-focus);
  box-shadow:0 0 0 3px rgba(64,146,255,.20);
}

.btn:disabled,
.actionBtn:disabled,
.headBtn:disabled,
.fvBtn:disabled{
  opacity:.55;
  cursor:not-allowed;
  transform:none;
}

.btn.busy,
.btn[aria-busy="true"],
.headBtn.busy{
  cursor:progress;
  opacity:.78;
  transform:none !important;
}

.toast{
  background:rgba(21,27,35,.97);
  border-color:var(--border-subtle);
}

.toastBody{
  color:var(--text-primary);
}

.toast-info{ border-color:rgba(64,146,255,.58); }
.toast-success{ border-color:rgba(63,185,80,.58); }
.toast-warn{ border-color:rgba(210,153,34,.58); }
.toast-error{ border-color:rgba(248,81,73,.58); }

/* Embedded Apply diff preview (VSCode-like side-by-side) */
.applyDiffModal{
  position:fixed;
  inset:0;
  z-index:7000;
  background:rgba(5,8,12,.58);
  backdrop-filter: blur(2px);
  display:flex;
  align-items:stretch;
  justify-content:stretch;
  padding:0;
}

.applyDiffModal[hidden]{
  display:none !important;
}

.applyDiffDialog{
  width:100vw;
  height:100vh;
  background:var(--bg-surface);
  border:1px solid var(--border-subtle);
  border-radius:0;
  box-shadow:0 18px 38px rgba(0,0,0,.45);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.applyDiffHead{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  padding:12px;
  border-bottom:1px solid var(--border-subtle);
  background:var(--bg-elevated);
}

.applyDiffHeadMain{
  min-width:0;
}

.applyDiffHeadMain .cardTitle{
  margin-bottom:6px;
}

.applyDiffHeadActions{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}

.applyDiffBody{
  flex:1;
  min-height:0;
  display:grid;
  grid-template-columns:minmax(260px, 340px) minmax(0, 1fr);
  background:var(--bg-base);
}

.applyDiffSidebar{
  border-right:1px solid var(--border-subtle);
  background:var(--bg-elevated);
  min-width:0;
  display:flex;
  flex-direction:column;
}

.applyDiffSearchWrap{
  padding:10px;
  border-bottom:1px solid var(--border-subtle);
}

.applyDiffSearch{
  width:100%;
  height:34px;
  border:1px solid var(--border-subtle);
  border-radius:8px;
  padding:6px 10px;
  background:rgba(0,0,0,.16);
  color:var(--text-primary);
  outline:none;
}

.applyDiffSearch:focus{
  border-color:var(--border-focus);
  box-shadow:0 0 0 3px rgba(64,146,255,.16);
}

.applyDiffFileList{
  flex:1;
  min-height:0;
  overflow:auto;
  padding:6px;
}

.applyDiffFileRow{
  width:100%;
  border:1px solid transparent;
  border-radius:8px;
  background:transparent;
  color:var(--text-secondary);
  text-align:left;
  padding:8px;
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
}

.applyDiffFileRow:hover{
  background:rgba(255,255,255,.04);
  border-color:var(--border-subtle);
}

.applyDiffFileRow.active{
  background:var(--accent-soft);
  border-color:rgba(64,146,255,.5);
  color:var(--text-primary);
}

.applyDiffFilePath{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  font-size:12.5px;
}

.diffBadge{
  font-size:11px;
  min-width:40px;
  text-align:center;
  border-radius:999px;
  padding:2px 8px;
  border:1px solid var(--border-subtle);
  background:rgba(255,255,255,.04);
  color:var(--text-secondary);
}

.diffBadge-add{
  color:#a8f2bf;
  border-color:rgba(63,185,80,.52);
  background:rgba(63,185,80,.14);
}

.diffBadge-mod{
  color:#8fc7ff;
  border-color:rgba(64,146,255,.52);
  background:rgba(64,146,255,.14);
}

.diffBadge-del{
  color:#ffb6b2;
  border-color:rgba(248,81,73,.52);
  background:rgba(248,81,73,.14);
}

.applyDiffEmpty{
  color:var(--text-muted);
  font-size:12px;
  padding:8px;
}

.applyDiffViewer{
  min-width:0;
  min-height:0;
  display:flex;
  flex-direction:column;
}

.applyDiffViewerHead{
  padding:10px 12px;
  border-bottom:1px solid var(--border-subtle);
  background:rgba(0,0,0,.16);
}

.applyDiffPath{
  color:var(--text-primary);
  font-size:12.5px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.applyDiffMeta{
  margin-top:4px;
}

.applyDiffGrid{
  flex:1;
  min-height:0;
  display:grid;
  grid-template-columns:minmax(0, 1fr) minmax(0, 1fr);
}

.applyDiffGrid.single-after{
  grid-template-columns:minmax(0, 1fr);
}

.applyDiffGrid.single-after .applyDiffPane{
  border-right:none;
}

.applyDiffPane{
  min-width:0;
  min-height:0;
  display:flex;
  flex-direction:column;
  border-right:1px solid var(--border-subtle);
}

.applyDiffPane[hidden]{
  display:none !important;
}

.applyDiffPane:last-child{
  border-right:none;
}

.applyDiffPaneHead{
  height:34px;
  flex:0 0 34px;
  display:flex;
  align-items:center;
  padding:0 10px;
  border-bottom:1px solid var(--border-subtle);
  background:rgba(0,0,0,.22);
  color:var(--text-muted);
  font-size:12px;
  letter-spacing:.2px;
}

.applyDiffCode{
  flex:1;
  min-height:0;
  overflow:auto;
  background:rgba(0,0,0,.22);
}

.applyDiffLine{
  display:grid;
  grid-template-columns:60px auto;
  width:max-content;
  min-width:100%;
  min-height:22px;
  font-family:var(--mono);
  font-size:12px;
  line-height:1.5;
}

.applyDiffLine:hover{
  background:rgba(255,255,255,.025);
}

.applyDiffLn{
  text-align:right;
  padding:2px 8px;
  border-right:1px solid var(--border-subtle);
  color:var(--text-muted);
  user-select:none;
}

.applyDiffTxt{
  display:block;
  margin:0;
  padding:2px 10px;
  white-space:pre;
  width:max-content;
  min-width:100%;
  overflow:visible;
  color:var(--text-primary);
}

.applyDiffLine-empty .applyDiffTxt{
  color:transparent;
}

.applyDiffLine-add{
  background:rgba(63,185,80,.14);
}

.applyDiffLine-del{
  background:rgba(248,81,73,.14);
}

.applyDiffLine-mod{
  background:rgba(64,146,255,.14);
}

.applyDiffFallback{
  margin:0;
  border-top:1px solid var(--border-subtle);
  background:rgba(0,0,0,.24);
  color:var(--text-secondary);
  padding:10px;
  max-height:180px;
  overflow:auto;
  font-size:12px;
  line-height:1.45;
}

body.has-apply-diff .layout{
  pointer-events:none;
}

body.has-apply-diff .applyDiffModal{
  pointer-events:auto;
}

@media (max-width: 1100px){
  .applyDiffBody{
    grid-template-columns:1fr;
    grid-template-rows:220px minmax(0, 1fr);
  }
  .applyDiffSidebar{
    border-right:none;
    border-bottom:1px solid var(--border-subtle);
  }
}

@media (max-width: 760px){
  .applyDiffDialog{
    width:100vw;
    height:100vh;
  }
  .applyDiffHead{
    flex-direction:column;
  }
  .applyDiffGrid{
    grid-template-columns:1fr;
    grid-template-rows:minmax(0, 1fr) minmax(0, 1fr);
  }
  .applyDiffPane{
    border-right:none;
    border-bottom:1px solid var(--border-subtle);
  }
  .applyDiffPane:last-child{
    border-bottom:none;
  }
}

/* =========================================================
   GitHub-like Files Tree visual refinement (visual-only)
   Scope: Files panel tree rows/actions/search alignment
   ========================================================= */
.panel.files .panelHead{
  align-items:center;
  gap:10px;
}

.panel.files .panelHeadTools{
  margin-left:auto;
}

.panel.files .fileList{
  padding:4px 0;
}

.panel.files .row{
  min-height:30px;
  gap:8px;
  padding:3px 12px;
  border-bottom:1px solid rgba(240,246,252,.06);
  background:transparent;
  transition:background-color .12s ease, box-shadow .12s ease;
}

.panel.files .row:hover{
  background:rgba(177,186,196,.12);
}

.panel.files .row.selected{
  background:rgba(56,139,253,.16);
  outline:none;
  box-shadow:inset 2px 0 0 rgba(56,139,253,.78);
}

.panel.files .rowLeft{
  gap:8px;
}

.panel.files .caret{
  width:16px;
  height:16px;
  border-radius:4px;
}

.panel.files .caret .ico{
  width:12px;
  height:12px;
}

.panel.files .fileIco{
  color:#8b949e;
}

.panel.files .row:hover .fileIco,
.panel.files .row.selected .fileIco{
  color:#c9d1d9;
}

.panel.files .name{
  flex:1 1 auto;
  font-size:14px;
}

.panel.files .row.row-picked{
  background:rgba(88,166,255,.10);
}

.panel.files .rowPick{
  width:16px;
  height:16px;
  border:1px solid rgba(139,148,158,.65);
  border-radius:4px;
  background:rgba(13,17,23,.95);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:0;
}

.panel.files .rowPick:checked{
  accent-color:rgba(56,139,253,.95);
}

.panel.files .rowPick:disabled{
  opacity:.5;
  cursor:not-allowed;
}

.panel.files .actions{
  margin-left:auto;
  gap:4px;
  opacity:0;
  visibility:hidden;
  transform:translateX(2px);
  transition:opacity .12s ease, visibility .12s ease, transform .12s ease;
}

.panel.files .row:hover .actions,
.panel.files .row.selected .actions,
.panel.files .row.ignored .actions{
  opacity:1;
  visibility:visible;
  pointer-events:auto;
  transform:translateX(0);
}

.panel.files .actionBtn{
  width:22px;
  height:22px;
  padding:0;
  border-radius:6px;
  align-items:center;
  justify-content:center;
}

.panel.files .actionBtn .ico{
  width:14px;
  height:14px;
}

.panel.files .badge{
  line-height:1.35;
  background:rgba(110,118,129,.16);
  border-color:rgba(110,118,129,.35);
}

/* Keep Files search compact and aligned with GitHub-like header controls */
.panel.files .filesSearchInput{
  width:170px;
  height:24px;
  border-radius:6px;
  background:rgba(13,17,23,.88);
  border-color:rgba(48,54,61,.9);
  font-size:12px;
}

.panel.files .filesSearchInput:focus{
  border-color:rgba(56,139,253,.65);
  box-shadow:0 0 0 1px rgba(56,139,253,.32);
}

.panel.files .filesSearchClear{
  width:16px;
  height:16px;
  right:5px;
  border-radius:4px;
}

.exportSelRow{
  align-items:center;
  justify-content:space-between;
  gap:8px;
}

.exportSelToggleWrap{
  display:inline-flex;
  align-items:center;
  gap:8px;
  min-height:24px;
}

.exportSelLabel{
  font-size:12px;
  color:var(--text);
}

.exportSelSwitch{
  position:relative;
  display:inline-flex;
  align-items:center;
  cursor:pointer;
  user-select:none;
}

.exportSelSwitch input{
  position:absolute;
  opacity:0;
  width:1px;
  height:1px;
  pointer-events:none;
}

.exportSelSlider{
  position:relative;
  display:inline-block;
  width:40px;
  height:22px;
  border-radius:999px;
  background:rgba(110,118,129,.30);
  border:1px solid rgba(110,118,129,.58);
  transition:background-color .16s ease, border-color .16s ease;
}

.exportSelSlider::before{
  content:"";
  position:absolute;
  width:16px;
  height:16px;
  left:2px;
  top:2px;
  border-radius:50%;
  background:#e6edf3;
  box-shadow:0 1px 2px rgba(0,0,0,.4);
  transition:transform .16s ease;
}

.exportSelSwitch input:checked + .exportSelSlider{
  background:rgba(56,139,253,.78);
  border-color:rgba(56,139,253,.95);
}

.exportSelSwitch input:checked + .exportSelSlider::before{
  transform:translateX(18px);
}

.exportSelSwitch input:focus-visible + .exportSelSlider{
  box-shadow:0 0 0 2px rgba(56,139,253,.35);
}

.exportSelCount{
  font-size:12px;
}

.exportSelActions{
  gap:8px;
  flex-wrap:wrap;
}

.exportLegacyCard{
  opacity:.88;
}

.exportPanel .exportGroup{
  margin-top:10px;
  padding-top:8px;
  border-top:1px solid rgba(240,246,252,.08);
}

.exportPanel .exportGroup:first-of-type{
  margin-top:6px;
}

.exportGroupTitle{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

.segCtl{
  display:inline-flex;
  border:1px solid rgba(240,246,252,.14);
  border-radius:8px;
  overflow:hidden;
  background:rgba(0,0,0,.22);
}

.segBtn{
  border:0;
  border-right:1px solid rgba(240,246,252,.10);
  background:transparent;
  color:var(--muted);
  font-size:12px;
  padding:6px 10px;
  cursor:pointer;
}

.segBtn:last-child{
  border-right:0;
}

.segBtn.active{
  background:rgba(56,139,253,.2);
  color:var(--text);
}

.optChk{
  display:block;
  font-size:12px;
  color:var(--text);
  margin:4px 0;
}

.optChk input{
  margin-right:6px;
  accent-color:rgba(56,139,253,.95);
}

/* =========================================================
   File Viewer editor UX add-ons: line numbers + find bar
   (visual + local editor chrome only)
   ========================================================= */
.fvEditWrap{
  position:relative;
  height:100%;
  display:none;
  pointer-events:auto;
}

.fvEditMain{
  display:flex;
  align-items:stretch;
  height:100%;
  min-height:0;
}

.fvGutter{
  width:64px;
  flex:0 0 64px;
  border-right:1px solid rgba(240,246,252,.10);
  background:rgba(0,0,0,.16);
  color:var(--muted);
  overflow:hidden;
  user-select:none;
}

.fvGutter pre{
  margin:0;
  padding:12px 8px 12px 0;
  text-align:right;
  font-family:var(--mono);
  font-size:12.5px;
  line-height:1.45;
  white-space:pre;
  font-variant-numeric:tabular-nums;
}

.fvEditWrap .fvEditor{
  flex:1 1 auto;
  min-width:0;
  min-height:0;
}

.fvFindBar{
  position:absolute;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  z-index:6;
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px;
  border:1px solid rgba(240,246,252,.12);
  border-radius:8px;
  background:rgba(13,17,23,.94);
  box-shadow:0 8px 20px rgba(0,0,0,.35);
  pointer-events:auto;
  max-width:calc(100% - 28px);
}

.fvFindInput{
  width:170px;
  height:26px;
  border:1px solid var(--border);
  border-radius:6px;
  background:rgba(0,0,0,.20);
  color:var(--text);
  font-size:12px;
  font-family:var(--font);
  padding:0 8px;
  outline:none;
}

.fvReplaceInput{
  width:170px;
}

.fvFindOpt{
  display:inline-flex;
  align-items:center;
  gap:4px;
  color:var(--muted);
  font-size:11px;
  user-select:none;
}

.fvFindOpt input{
  accent-color:rgba(56,139,253,.95);
}

.fvFindInput:focus{
  border-color:rgba(56,139,253,.65);
  box-shadow:0 0 0 1px rgba(56,139,253,.32);
}

.fvFindBtn{
  height:26px;
  min-width:30px;
  border:1px solid rgba(240,246,252,.12);
  border-radius:6px;
  background:rgba(255,255,255,.03);
  color:var(--text);
  font-size:12px;
  padding:0 8px;
  cursor:pointer;
}

.fvFindBtn:hover{
  background:rgba(255,255,255,.08);
}

.fvFindStatus{
  min-width:64px;
  color:var(--muted);
  font-size:11px;
  text-align:right;
  font-variant-numeric:tabular-nums;
}

/* keep text visible while find bar overlays top-right */
.fvEditWrap.find-open .fvEditor,
.fvEditWrap.find-open .fvGutter pre,
.fvEditWrap.find-open .fvFindOverlay{
  padding-top:40px;
}


/* =========================================================
   File Viewer view-mode line numbers (plain/raw code view)
   ========================================================= */
.fvCodeWithLines{
  display:grid;
  grid-template-columns:64px minmax(0,1fr);
  align-items:start;
  min-width:100%;
}

.fvLineNums{
  margin:0;
  padding:12px 8px 12px 0;
  text-align:right;
  border-right:1px solid rgba(240,246,252,.10);
  background:rgba(0,0,0,.16);
  color:var(--muted);
  user-select:none;
  font-family:var(--mono);
  font-size:12.5px;
  line-height:1.45;
  white-space:pre;
  font-variant-numeric:tabular-nums;
}

.fvCodeWithLines .fvCode{
  min-width:0;
  margin:0;
}

/* Find bar visibility hardening (prevents stuck/open-on-load regressions) */
.fvFindBar[hidden]{
  display:none !important;
}

.fvCard[data-find-open="1"] .fvFindBar{
  pointer-events:auto;
}

/* IDE-like find overlay inside textarea stack (non-destructive) */
.fvEditorStack{
  position:relative;
  flex:1 1 auto;
  min-width:0;
  min-height:0;
}

.fvEditorStack .fvEditor{
  position:relative;
  z-index:2;
  background:transparent;
}

.fvFindOverlay{
  position:absolute;
  inset:0;
  z-index:1;
  margin:0;
  padding:12px 14px;
  overflow:hidden;
  pointer-events:none;
  font-family:var(--mono);
  font-size:12.5px;
  line-height:1.45;
  white-space:pre;
  color:transparent;
}

.fvFindOverlay code{
  font-family:inherit;
  font-size:inherit;
  line-height:inherit;
  color:transparent;
  white-space:inherit;
}

.findMatch{
  background:rgba(187,128,9,.22);
  color:transparent;
  border-radius:2px;
}

.findMatchActive{
  background:rgba(56,139,253,.42);
}

.fvStatusBar{
  display:flex;
  gap:12px;
  align-items:center;
  min-height:26px;
  padding:4px 10px;
  border-top:1px solid rgba(240,246,252,.10);
  background:rgba(0,0,0,.20);
  color:var(--muted);
  font-size:11px;
  font-family:var(--mono);
}

/* Export presets quick controls (Files header) */
.presetQuick{
  display:inline-flex;
  align-items:center;
  gap:6px;
  flex-wrap:wrap;
}
.presetLabel{
  font-size:11px;
  color:var(--muted);
}
.presetSelect{
  min-width:130px;
  max-width:220px;
  height:26px;
  border:1px solid var(--border);
  border-radius:7px;
  background:rgba(13,17,23,.72);
  color:var(--text);
  font-size:12px;
  padding:0 6px;
}
.btn.tiny{
  padding:4px 8px;
  font-size:11px;
}
.presetAutoWrap{
  display:inline-flex;
  align-items:center;
  gap:6px;
  margin-left:2px;
}
.presetAutoLabel{
  font-size:11px;
  color:var(--muted);
}
.presetFeedback{
  margin-top:6px;
  font-size:11px;
}
.presetFeedback.ok{ color:var(--ok); }
.presetFeedback.partial{ color:var(--warn); }
.presetFeedback.broken{ color:var(--bad); }
.presetFeedback.loading{ color:var(--muted); }
